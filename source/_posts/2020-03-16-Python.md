---
title:  "Python应用技巧"
date:   2020-03-16 16:31:18 +0800
categories:
- Python
tags:
- Python Numpy 


---

这篇文章主要记述了Python应用的一些笔记。
<!--more-->




## 1、Python操作Excel简化操作

需求：从Excel表中提取出人的名字看看其在线时间是否满足100min，用来判定其有没有上课。Excel格式为CSV后缀的。

输入：人的名字（文本形式）

输出：排序好的excel表

若文本中的名字存在，打印出该行值

> **逗号分隔值**（Comma-Separated Values，**CSV**，有时也称为**字符分隔值**，因为分隔字符也可以不是逗号），其文件以[纯文本](https://zh.wikipedia.org/wiki/纯文本)形式存储[表格](https://zh.wikipedia.org/wiki/表格)数据（数字和文本）。纯文本意味着该文件是一个[字符](https://zh.wikipedia.org/wiki/字符)序列，不含必须像二进制数字那样被解读的数据。CSV文件由任意数目的[记录](https://zh.wikipedia.org/wiki/记录)组成，记录间以某种换行符分隔；每条记录由[字段](https://zh.wikipedia.org/w/index.php?title=字段&action=edit&redlink=1)组成，字段间的分隔符是其它字符或字符串，最常见的是逗号或[制表符](https://zh.wikipedia.org/wiki/制表键#定位字符)。通常，所有记录都有完全相同的字段序列。

参考代码：

```python
# coding=utf-8
import xlrd #Excel Read
import xlwt #Excel Write
import sys
reload(sys)
sys.setdefaultencoding('utf8')

def read_excel():
    # 打开文件
    workbook = xlrd.open_workbook(r'0311.xls')
    # 获取所有sheet
    sheet_name = workbook.sheet_names()[0]

    # 根据sheet索引或者名称获取sheet内容
    sheet = workbook.sheet_by_index(0)  # sheet索引从0开始
    
    name_list = open('name.txt')
    # 创建excel文件
    filename = xlwt.Workbook()
    # 给工作表命名，test
    sheet_write = filename.add_sheet("test")
    # print (str(name).decode("unicode_escape").encode("utf8"))
    # if name[2] != "unknow":
    # if int(name[2]) > 100:#如果在线时间大于100
    # print (name[2])
    try:
        row = 0
        while True:
            line = name_list.readline()# 从文本逐行读取名字
            if line:
                line = line.strip('\n')#去除换行符
                for rown in range(sheet.nrows):
                    name = sheet.row_values(rown)  # 获取第rown行内容
                    if line in name[0]:
                        row = row + 1
                        for cols in [0,1,2,3]:
                            sheet_write.write(row, cols, name[cols])
                            print (str(name).decode("unicode_escape").encode("utf8"))
                                    #print (str(name[0])
            else:
                break
    finally:
        filename.save("0311_sort.xls")
        name_list.close()

if __name__ == '__main__':
    # 读取Excel
    read_excel();
    print ('----读取成功----')
```



## 2、Python Numpy

![image-20200322222621682](https://i.loli.net/2020/03/30/GDkBnV4L1hesg3l.png)

### 2.1 numpy中 **  ？

就是给里面每个元素开平方的意思

It's just the square of each element.

```py
from numpy import *
a = arange(4).reshape((2,2))
print a**2
--- prints
--- [[0 1]
--- [4 9]]
```

### 2.2 Numpy 基本除法运算和模运算

\# divide函数在整数和浮点数除法中均只保留整数部分(python3中的np.divide == np.true_divide)

```python
a = np.array([2,6,5])
b = np.array([1,2,3])
print (np.divide(a,b),np.divide(b,a))
# (array([2, 3, 1]), array([0, 0, 0]))
```


\# true_divide函数与数学中的除法定义更为接近，即返回除法的浮点数结果而不作截断

```python
print (np.true_divide(a,b),np.true_divide(b,a))
# (array([ 2. , 3. , 1.66666667]), array([ 0.5 , 0.33333333, 0.6 ]))
```

\# floor_divide函数总是返回整数结果，相当于先调用divide函数再调用floor函数(floor函数将对浮点数进行向下取整并返回整数)

```python
print (np.floor_divide(a,b),np.floor_divide(b,a))
# [2 3 1] [0 0 0]
c = 3.14 * b
print (np.floor_divide(c,b),np.floor_divide(b,c))
# [ 3. 3. 3.] [ 0. 0. 0.]
```

\# /运算符相当于调用divide函数

```python
print (a/b,b/a)
# (array([2, 3, 1]), array([0, 0, 0]))
```

\# 运算符//对应于floor_divide函数

```python
print (a//b,b//a)
# [2 3 1] [0 0 0]
print (c//b,b//c)
# [ 3. 3. 3.] [ 0. 0. 0.]
```

2. 模运算
   \# 计算模数或者余数，可以使用NumPy中的mod、remainder和fmod函数。也可以用%运算符

```
import numpy as np
```

\# remainder函数逐个返回两个数组中元素相除后的余数

```python
d = np.arange(-4,4)
print (np.remainder(d,2))
# [0 1 0 1 0 1 0 1]　　
```

\# mod函数与remainder函数的功能完全一致

```python
print (np.mod(d,2))
# [0 1 0 1 0 1 0 1]
```

\# %操作符仅仅是remainder函数的简写(功能一样)

```python
print ( d % 2 )
# [0 1 0 1 0 1 0 1]
```

\# fmod函数处理负数的方式与remainder、mod和%不同。所得余数的正负由被除数决定，与除数的正负无关

```python
print (np.fmod(d,2))
# [ 0 -1 0 -1 0 1 0 1]
```

### 2.3、Numpy 中clip函数的使用

numpy.clip(a, a_min, a_max, out=None)[source]

```
import numpy as np
x=np.array([1,2,3,5,6,7,8,9])
np.clip(x,3,8)
Out[88]:
array([3, 3, 3, 5, 6, 7, 8, 8])
```

也就是说clip这个函数将将数组中的元素限制在a_min, a_max之间，大于a_max的就使得它等于 a_max，小于a_min,的就使得它等于a_min。

## 3、通过图片修改时间重命名

3.1 、Q：os.rename()导致WindowsError: [Error 183]的问题

A：Error 183是文件已经存在错误,要更改成的文件的名字已经存在，换一个不冲突的名称就可以了。

```python
#coding=utf-8
import os
from nt import chdir
import datetime
import random

# 用到的知识
# os.path.getatime(file) 输出文件访问时间
# os.path.getctime(file) 输出文件的创建时间
# os.path.getmtime(file) 输出文件最近修改时间

def renameF(preName, newName):
    chdir(os.path.dirname(preName))
    os.rename(preName, newName)

if __name__=="__main__":
    source_dir = "./"
    output_dir = "./outputImages/"
    g = os.walk(source_dir)


    for path, dir_list, file_list in g:
        for file_name in file_list:
            cnt = random.randint(100,999)
            TIME = str(datetime.datetime.fromtimestamp(os.path.getmtime(file_name)).strftime('%Y%m%d%H%M%S'))
            NAME = "image-" + TIME + str(cnt) + ".png";
            # print (os.path.join(source_dir, file_name))
            os.rename(file_name, NAME)

```

